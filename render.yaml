# Render Blueprint for Nexus Release Readiness Bot
# =================================================
# 
# Deploy with: Connect this repo to Render and it will auto-deploy
# Or use: render blueprint apply
#
# This deploys the Admin Dashboard backend API which provides:
# - SSO/RBAC authentication
# - Feature request management
# - System configuration
# - Agent health monitoring

services:
  # =============================================================================
  # Admin Dashboard Backend API
  # =============================================================================
  - type: web
    name: nexus-admin-api
    runtime: python
    region: oregon
    plan: free
    rootDir: .
    buildCommand: |
      pip install --upgrade pip
      pip install -r services/admin_dashboard/backend/requirements.txt
      mkdir -p /opt/render/project/src/shared
      cp -r shared/* /opt/render/project/src/shared/ 2>/dev/null || echo "Shared lib copy skipped"
      ls -la /opt/render/project/src/shared/ || echo "No shared dir"
    startCommand: cd services/admin_dashboard/backend && uvicorn main:app --host 0.0.0.0 --port $PORT --timeout-keep-alive 120
    healthCheckPath: /health
    autoDeploy: true
    envVars:
      # Python environment
      - key: PYTHONPATH
        value: /opt/render/project/src:/opt/render/project/src/shared
      - key: PYTHON_VERSION
        value: "3.11.0"
      
      # Application environment
      - key: NEXUS_ENV
        value: production
      
      # Authentication (RBAC)
      - key: NEXUS_RBAC_ENABLED
        value: "true"
      - key: NEXUS_JWT_SECRET
        generateValue: true
      - key: NEXUS_TOKEN_EXPIRE_MINUTES
        value: "60"
      - key: NEXUS_REFRESH_TOKEN_DAYS
        value: "7"
      - key: NEXUS_ADMIN_EMAIL
        value: admin@nexus.dev
      - key: NEXUS_SSO_PROVIDER
        value: local
      
      # CORS - Allow Vercel frontend (wildcard allows any Vercel deployment)
      - key: NEXUS_CORS_ORIGINS
        value: "https://nexus-admin-dashboard-seven.vercel.app,https://*.vercel.app,http://localhost:5173,http://localhost:3000"
      
      # Frontend URL for redirects
      - key: NEXUS_FRONTEND_URL
        value: "https://nexus-admin-dashboard-seven.vercel.app"

# =============================================================================
# Optional: Redis for persistent storage
# =============================================================================
# Uncomment if you need persistent storage (free tier: 25MB)
#
#   - type: redis
#     name: nexus-redis
#     plan: free
#     region: oregon
#     maxmemoryPolicy: allkeys-lru

